<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button></ion-back-button>
        </ion-buttons>
        <ion-title translate>CART.TITLE</ion-title>

        <ion-buttons slot="end" collapse="true">
            <button *ngIf="isAndroid" ion-button (click)="bluetoothPrinting()" slot="icon-only" class="print-button">
                <ion-icon name="print"> </ion-icon>
            </button>
            <button
                *ngIf="!isAndroid"
                ion-button
                ngxPrint
                printSectionId="preview"
                styleSheetFile="assets/css/cart-preview.css"
                printDelay="200"
                slot="icon-only"
                class="print-button"
                (click)="printFinished()"
            >
                <ion-icon name="print"> </ion-icon>
            </button>
            <button ion-button slot="icon-only" (click)="confirmEmptyCart()">
                <ion-icon name="trash"></ion-icon>
            </button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content>
    <div *ngIf="(cartTotal$ | async) > 0; else emptyCart">
        <ion-list *ngFor="let categorySumm of cartStateSummary | keyvalue">
            <ion-list-header>
                <div class="category-title">
                    <ion-icon [name]="categorySumm.value.category.icon"></ion-icon>
                    <ion-label>{{ categorySumm.key }}</ion-label>
                </div>
            </ion-list-header>
            <ion-item *ngFor="let typeTickets of categorySumm.value.tickets | keyvalue">
                <ion-grid>
                    <ion-row>
                        <ion-col size-sm size="12">
                            <tb-ticket [ticket]="typeTickets.value.ticket"></tb-ticket>
                        </ion-col>
                        <ion-col>
                            <ion-select
                                class="input-units"
                                [value]="typeTickets.value.units"
                                (ionChange)="unitsChange($event, typeTickets.value.ticket)"
                                interface="popover"
                            >
                                <ion-select-option *ngFor="let unit of units" [value]="unit">{{ unit }}</ion-select-option>
                            </ion-select>
                        </ion-col>
                        <ion-col>
                            <ion-label> = {{ typeTickets.value.total }} â‚¬ </ion-label>
                        </ion-col>
                        <ion-col>
                            <ion-button fill="clear" (click)="deleteTicket(typeTickets.value.ticket)">
                                <ion-icon name="trash" slot="icon-only" class="trash-icon"></ion-icon>
                            </ion-button>
                        </ion-col>
                    </ion-row>
                </ion-grid>
            </ion-item>
        </ion-list>
    </div>
    <ng-template #emptyCart>
        <div class="empty-cart">
            <ion-icon size="large" name="cart"></ion-icon>
            <ion-label translate>CART.NO_TICKETS</ion-label>
        </div>
    </ng-template>
    <div id="preview">
        <tb-cart-preview #preview [cartStateSummary]="cartStateSummary" (printFinished)="printFinished()"></tb-cart-preview>
    </div>
</ion-content>
<ion-footer *ngIf="(cartTotal$ | async) > 0">
    <ion-item>
        <h2 slot="end" translate [translateParams]="totalParam">CART.TOTAL</h2>
    </ion-item>
</ion-footer>
